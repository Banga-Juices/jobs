<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>التقديم على وظيفة كاشير </title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f2f4f6;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 480px;
      margin: auto;
      padding: 25px 20px 40px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.05);
      margin-top: 30px;
    }

    .logo {
      text-align: center;
      margin-bottom: 15px;
    }

    .logo img {
      width: 120px;
      border-radius: 10px;
    }

    h2 {
      text-align: center;
      color: #2d9958;
      margin-bottom: 20px;
      font-size: 22px;
    }

    #errorBox {
      display: none;
      background: #ffe5e5;
      color: #b40000;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    label {
      font-weight: 600;
      margin-bottom: 5px;
      display: block;
      font-size: 15px;
    }

    input, select {
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
    }

    input[type="file"] {
      padding: 6px;
      font-size: 14px;
    }

    .radio-group {
      display: flex;
      gap: 10px;
    }

    .radio-group input[type="radio"] {
      display: none;
    }

    .radio-group label {
      flex: 1;
      text-align: center;
      background-color: #eee;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: 0.3s;
    }

    .radio-group input[type="radio"]:checked + label {
      background-color: #2d9958;
      color: white;
      border-color: #2d9958;
    }

    button {
      background-color: #2d9958;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background-color: #24814c;
    }

    @media (max-width: 480px) {
      .container {
        padding: 20px 15px;
      }

      h2 {
        font-size: 20px;
      }

      input, select {
        font-size: 14px;
        padding: 9px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
  
    <h2>نموذج التقديم على وظيفة كاشير</h2>

    <div id="errorBox"></div>

    <form onsubmit="return false;" novalidate>
      <div><label>رقم الهوية (10 أرقام)</label><input type="tel" name="id" required /></div>
      <div><label>الاسم الرباعي</label><input type="text" name="fullname" required /></div>
      <div><label>تاريخ الميلاد (ميلادي)</label><input type="date" name="birthdate" required /></div>
      <div><label>رقم الجوال</label><input type="tel" name="phone" inputmode="numeric" required /></div>
      <div>
        <label>السكن - المنطقة</label>
        <select name="area" required>
          <option value="">اختر المنطقة</option>
          <option>الهفوف</option>
          <option>المبرز</option>
          <option>القرى الشرقية</option>
        </select>
      </div>
      <div><label>الحي</label><input type="text" name="district" required /></div>
      <div>
        <label>السنة الدراسية الجامعية</label>
        <select name="year" required>
          <option value="">اختر السنة</option>
          <option>الأولى</option>
          <option>الثانية</option>
          <option>الثالثة</option>
          <option>الرابعة</option>
          <option>الخامسة</option>
        </select>
      </div>
      <div><label>التخصص</label><input type="text" name="major" required /></div>
      <div>
        <label>هل تملك سيارة؟</label>
        <div class="radio-group">
          <input type="radio" id="carYes" name="car" value="نعم" required><label for="carYes">نعم</label>
          <input type="radio" id="carNo" name="car" value="لا"><label for="carNo">لا</label>
        </div>
      </div>
      <div>
        <label>هل سبق لك العمل ككاشير؟</label>
        <div class="radio-group">
          <input type="radio" id="expYes" name="cashier_experience" value="نعم" required><label for="expYes">نعم</label>
          <input type="radio" id="expNo" name="cashier_experience" value="لا"><label for="expNo">لا</label>
        </div>
      </div>
      <div><label>الصورة الشخصية</label><input type="file" name="photo" accept="image/*" required /></div>
      <div><label>السيرة الذاتية (اختياري)</label><input type="file" name="cv" accept=".pdf,.doc,.docx" /></div>

      <div id="loading" style="display:none; text-align:center;">
        <p>جاري الإرسال...</p>
      </div>

      
      <button type="submit">إرسال الطلب</button>
    </form>
  </div>

  <script>
    function validateForm() {
      const errors = [];
      const id = document.querySelector('input[name="id"]').value.trim();
      const phone = document.querySelector('input[name="phone"]').value.trim();
      const nameParts = document.querySelector('input[name="fullname"]').value.trim().split(/\s+/);
      const area = document.querySelector('select[name="area"]').value;
      const district = document.querySelector('input[name="district"]').value.trim();
      const year = document.querySelector('select[name="year"]').value;
      const major = document.querySelector('input[name="major"]').value.trim();
      const carSelected = document.querySelector('input[name="car"]:checked');
      const expSelected = document.querySelector('input[name="cashier_experience"]:checked');
      const photo = document.querySelector('input[name="photo"]').files.length;
      const birthdate = document.querySelector('input[name="birthdate"]').value.trim();
if (!birthdate) errors.push("يرجى إدخال تاريخ الميلاد.");

      if (!/^\d{10}$/.test(id)) errors.push("رقم الهوية يجب أن يتكون من 10 أرقام.");
      if (nameParts.length !== 4) errors.push("الاسم يجب أن يكون رباعي.");
      if (!/^\d{10}$/.test(phone)) errors.push("رقم الجوال يجب أن يتكون من 10 أرقام.");
      if (area === "") errors.push("يجب اختيار المنطقة.");
      if (!district) errors.push("يرجى إدخال الحي.");
      if (year === "") errors.push("يرجى اختيار السنة الدراسية.");
      if (!major) errors.push("يرجى إدخال التخصص.");
      if (!carSelected) errors.push("يرجى اختيار هل تملك سيارة.");
      if (!expSelected) errors.push("يرجى اختيار هل سبق لك العمل ككاشير.");
      if (!photo) errors.push("يرجى إرفاق صورة شخصية.");

      const errorBox = document.getElementById("errorBox");
      if (errors.length > 0) {
        errorBox.innerHTML = "<ul style='margin:0; padding-right:20px'>" + errors.map(e => `<li>${e}</li>`).join('') + "</ul>";
        errorBox.style.display = "block";
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return false;
      } else {
        errorBox.style.display = "none";
        return true;
      }
    }
  </script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAfvxROrhBdsFxkX9U5kriI4ySs9c41roY",
    authDomain: "bangadata-57f98.firebaseapp.com",
    projectId: "bangadata-57f98",
    storageBucket: "bangadata-57f98.appspot.com",
    messagingSenderId: "26361247251",
    appId: "1:26361247251:web:0bf34e6df881f45110f1e6",
    measurementId: "G-C4L0MX3K1D"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const form = document.querySelector("form");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!validateForm()) return;
    document.getElementById("loading").style.display = "block";


    const formData = new FormData(form);
    const id = formData.get("id").trim();
    const name = formData.get("fullname").trim();
    const birthdate = formData.get("birthdate");
    const phone = formData.get("phone").trim();
    const area = formData.get("area");
    const district = formData.get("district");
    const year = formData.get("year");
    const major = formData.get("major");
    const car = formData.get("car");
    const experience = formData.get("cashier_experience");
    const photoFile = formData.get("photo");
    const cvFile = formData.get("cv");
    const folderName = `${name} - ${id}`;

    async function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => {
          const base64 = reader.result.split(',')[1]; // remove data:mime/type;base64,
          resolve(base64);
        };
        reader.onerror = error => reject(error);
      });
    }

    async function uploadFile(file, label) {
      const base64 = await toBase64(file);
      const data = new FormData();
      data.append("file", base64);
      data.append("name", folderName); // مجلد واحد فقط
data.append("filename", `${id} - ${label}`); // اسم الملف = رقم الهوية + نوعه

      data.append("mimeType", file.type);

      const res = await fetch("https://script.google.com/macros/s/AKfycbzvXQ2QQJTnP973lNn_uARMaJuZouBlRPcjfCYf-aTyyO4wJ9SAh-M0Up47BHIy7fPoIw/exec", {
        method: "POST",
        body: data,
      });

      const result = await res.json();
      if (result.status !== "success") throw new Error(result.message);
      return result.fileUrl;
    }

    let photoUrl = "";
    try {
      photoUrl = await uploadFile(photoFile, "الصورة");
    } catch (e) {
      alert("فشل رفع الصورة: " + e.message);
      document.getElementById("loading").style.display = "none";

      return;
    }

    let cvUrl = "";
    if (cvFile && cvFile.name) {
      try {
        cvUrl = await uploadFile(cvFile, "السيرة الذاتية");
      } catch (e) {
        alert("فشل رفع السيرة الذاتية: " + e.message);
        document.getElementById("loading").style.display = "none";

        return;
      }
    }

    await setDoc(doc(db, "JOBS", "job-062025", "applicants", id), {
      id,
      name,
      birthdate,
      phone,
      area,
      district,
      year,
      major,
      car,
      experience,
      photoUrl,
      cvUrl,
      timestamp: new Date().toISOString()
    });

    form.innerHTML = `<h2>تم استلام الطلب بنجاح</h2>`;
  });
</script>

  </script>
</body>
</html>
